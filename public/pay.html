<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TrueMatch — Payment</title>

  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/animations.css">
  <link rel="stylesheet" href="/responsive.css">
  <link rel="stylesheet" href="/auth.css">

  <style>
    /* background canvas (kept) */
    #tm-bg-canvas{
      position:fixed; inset:0; width:100vw; height:100vh; pointer-events:none;
      z-index:0; opacity:.95; transform:translateZ(0);
    }
    body.has-bg-canvas > :not(#tm-bg-canvas){ position:relative; z-index:1; }
    html{ background:#000; }
    @media (prefers-reduced-motion: reduce){ #tm-bg-canvas{ opacity:.35; } }

    /* center header (Payment + subtitle) */
    .auth-header{
      margin-top: 24px;
      width: 100%;
      padding: 0 24px;
      box-sizing: border-box;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    .auth-header h1,
    .auth-header p{ text-align:center; }

    /* feature list */
    .feature-list{ list-style:none; margin:12px 0 0; padding:0; }
    .feature-item{
      display:flex; align-items:center; gap:10px;
      padding:8px 0; border-top:1px solid rgba(255,255,255,.06);
    }
    .feature-item:first-child{ border-top:0; }
    .feature-icon{
      width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center;
      border-radius:999px; font-size:12px; line-height:1;
      background:rgba(100,233,238,.15); outline:1px solid rgba(100,233,238,.35); color:#64E9EE;
      flex:0 0 20px;
    }
    .feature-text{ color:#cfcfcf; font-size:.95rem; }

    .plan-row{ margin-top:14px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

    /* alert + helper strip */
    .notice{
      margin:0 auto 14px; padding:10px 12px;
      border:1px solid rgba(255,255,255,.14);
      border-radius:14px; background:rgba(255,255,255,.04);
      color:#d9e1ff; font-size:.95rem;
    }
    .notice strong{ color:#fff; }

    /* back row */
    .top-actions{
      width:100%; max-width:840px; margin:14px auto -4px; padding:0 16px; box-sizing:border-box;
      display:flex; justify-content:space-between; align-items:center; gap:12px;
    }
    .link-back{
      display:inline-flex; align-items:center; gap:8px; text-decoration:none;
      border:1px solid rgba(255,255,255,.14); border-radius:999px; padding:8px 12px;
      color:#cfe0ff; background:rgba(255,255,255,.02);
    }
    .link-back:hover{ background:rgba(255,255,255,.06); color:#fff; }

    .secure-badge{ color:#b8c4e6; font-size:.9rem; }
  </style>
</head>
<body class="tm-dark has-bg-canvas">
  <!-- Interactive background (constellation) -->
  <canvas id="tm-bg-canvas" aria-hidden="true"></canvas>

  <div class="top-actions">
    <a id="btnBack" href="/tier.html" class="link-back" aria-label="Back to plans" data-back-tier="1">← Back</a>
    <div class="secure-badge">Secure crypto checkout via Coinbase</div>
    <button id="btnLogout" class="link-back" type="button" aria-label="Log out">Logout</button>
  </div>

  <header class="auth-header">
    <img src="/assets/images/truematch-hero-logo.png" alt="TrueMatch" class="auth-logo">
    <h1>Payment</h1>
    <p>Complete your subscription.</p>
  </header>

  <main class="auth-wrap">
    <div class="auth-card">
      <div class="notice">
        <strong>Heads up:</strong> You will not be taken to your dashboard until payment is successfully completed. 
        If you close or cancel checkout, you’ll be returned to Plan Selection.
      </div>

      <p><strong>Plan:</strong> <span id="planLabel">—</span></p>
      <p><strong>Amount:</strong> <span id="planAmount">—</span></p>

      <!-- single-tier feature mirror -->
      <ul id="planFeatures" class="feature-list"></ul>

      <div class="plan-row">
        <button id="btnPay" class="btn btn-primary">Pay now</button>
        <a id="linkChangePlan" href="/tier.html" class="btn btn-outline-inverse" data-back-tier="1">Change plan</a>
      </div>
    </div>
  </main>

  <!-- kept: background script -->
  <script>
  (() => {
    const canvas = document.getElementById('tm-bg-canvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d', { alpha: true });
    if (!ctx) return;
    const reduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    const mouse = { x: 0, y: 0, active: false };
    const particles = [];
    let cw = 0, ch = 0, dpr = 1, raf = null;
    const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
    function pickCount(){ const area = innerWidth * innerHeight; return clamp(Math.floor(area/22000)+28, 38, 90); }
    function resize(){
      dpr = Math.min(devicePixelRatio||1, 2);
      cw = innerWidth; ch = innerHeight;
      canvas.width = Math.floor(cw*dpr); canvas.height = Math.floor(ch*dpr);
      canvas.style.width = cw+'px'; canvas.style.height = ch+'px';
      ctx.setTransform(dpr,0,0,dpr,0,0); init(); draw(true);
    }
    function init(){
      particles.length = 0; const n = pickCount();
      for (let i=0;i<n;i++) particles.push({ x:Math.random()*cw, y:Math.random()*ch, vx:(Math.random()-.5)*.35, vy:(Math.random()-.5)*.35, r:1+Math.random()*1.3 });
    }
    function step(){
      for (const p of particles){
        p.x+=p.vx; p.y+=p.vy;
        if (p.x<0||p.x>cw) p.vx*=-1; if (p.y<0||p.y>ch) p.vy*=-1;
        p.x=clamp(p.x,0,cw); p.y=clamp(p.y,0,ch);
        if (mouse.active){
          const dx=p.x-mouse.x, dy=p.y-mouse.y, d2=dx*dx+dy*dy, inf=220;
          if (d2<inf*inf && d2>1e-3){ const d=Math.sqrt(d2), f=(1-d/inf)*.035; p.vx+=(dx/d)*f; p.vy+=(dy/d)*f; }
        }
        p.vx*=.985; p.vy*=.985;
      }
    }
    function draw(staticOnly=false){
      ctx.clearRect(0,0,cw,ch);
      ctx.globalCompositeOperation='lighter';
      const md=150, md2=md*md;
      for (let i=0;i<particles.length;i++){
        const a=particles[i];
        for (let j=i+1;j<particles.length;j++){
          const b=particles[j], dx=a.x-b.x, dy=a.y-b.y, d2=dx*dx+dy*dy;
          if (d2<=md2){ const t=1-(Math.sqrt(d2)/md), apha=t*.12;
            ctx.strokeStyle=`rgba(255,255,255,${apha})`; ctx.lineWidth=1;
            ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke();
          }
        }
      }
      if (mouse.active){
        const r=210, r2=r*r;
        for (const p of particles){
          const dx=p.x-mouse.x, dy=p.y-mouse.y, d2=dx*dx+dy*dy;
          if (d2<r2){ const t=1-(Math.sqrt(d2)/r), a=t*.18;
            ctx.strokeStyle=`rgba(100,233,238,${a})`; ctx.lineWidth=1;
            ctx.beginPath(); ctx.moveTo(p.x,p.y); ctx.lineTo(mouse.x,mouse.y); ctx.stroke();
          }
        }
      }
      for (const p of particles){ ctx.fillStyle='rgba(255,255,255,.55)'; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); }
      ctx.globalCompositeOperation='source-over';
      if (!reduceMotion && !staticOnly) step();
    }
    function loop(){ draw(false); raf=requestAnimationFrame(loop); }
    function onMove(e){ const t=e.touches&&e.touches[0]; mouse.x=(t?t.clientX:e.clientX); mouse.y=(t?t.clientY:e.clientY); mouse.active=true; }
    function onLeave(){ mouse.active=false; }
    addEventListener('resize', ()=>{ cancelAnimationFrame(raf); raf=null; resize(); if(!reduceMotion) loop(); }, { passive:true });
    addEventListener('mousemove', onMove, { passive:true });
    addEventListener('touchmove', onMove, { passive:true });
    addEventListener('mouseleave', onLeave, { passive:true });
    addEventListener('touchend', onLeave, { passive:true });
    resize(); if(!reduceMotion) loop();
  })();
  </script>

  <script src="./tm-loader.js"></script>
  <script src="/pay.js" type="module"></script>
</body>
</html>
