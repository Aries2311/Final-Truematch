<!doctype html>
<html lang="en">
<head>
  <script>window.API_BASE = '';</script>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>TrueMatch â€¢ Preferences</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/responsive.css">
  <link rel="stylesheet" href="/auth.css">

  <style>
    #tm-bg-canvas{
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 0;
      opacity: .95;
      transform: translateZ(0);
    }
    body.has-bg-canvas > :not(#tm-bg-canvas){
      position: relative;
      z-index: 1;
    }
    html{ background:#000; }
    @media (prefers-reduced-motion: reduce){
      #tm-bg-canvas{ opacity: .35; }
    }
  </style>

</head>
<body class="tm-dark has-bg-canvas">
  <canvas id="tm-bg-canvas" aria-hidden="true"></canvas>
  <header class="auth-header">
    <img src="/assets/images/truematch-hero-logo.png" alt="TrueMatch" class="auth-logo">
    <h1>Set your preferences</h1>
    <p>City, age range, and ethnicity.</p>
  </header>

  <main class="auth-wrap">
    <div class="auth-card">
      <form id="preferencesForm" autocomplete="on">
  <label>
    <span>City</span>
    <input
      type="text"
      id="city"
      name="city"
      placeholder="e.g., Lagos"
      required
    >
  </label>

  <div style="display:flex; gap:10px;">
    <label style="flex:1;">
      <span>Min age</span>
      <input
        id="ageMin"
       name="ageMin"
       type="number"
       inputmode="numeric"
       min="18"
       max="80"
       value="25"
       required
      >
    </label>
    <label style="flex:1;">
      <span>Max age</span>
      <input
        id="ageMax"
        name="ageMax"
        type="number"
        inputmode="numeric"
        min="18"
        max="80"
        value="35"
        required
      >
    </label>
  </div>

  <label>
    <span>Ethnicity</span>
    <select
      id="ethnicity"
      name="ethnicity"
      required
    >
      <option value="" selected disabled>Choose one</option>
      <option value="african">African</option>
      <option value="asian">Asian</option>
      <option value="caucasian">Caucasian</option>
      <option value="hispanic">Hispanic / Latino</option>
      <option value="middle-eastern">Middle Eastern</option>
      <option value="mixed">Mixed</option>
      <option value="other">Other</option>
    </select>
  </label>

  <label>
    <span>Looking for</span>
    <select
      id="lookingFor"
      name="lookingFor"
      required
    >
      <option value="women" selected>Women</option>
      <option value="men">Men</option>
    </select>
  </label>

  <!-- Advanced filters: hidden by default, JS will show for paid plans only -->
  <section
    class="preferences-section hidden"
    id="advancedPrefsSection"
    style="display:none;"
  >
    <h2 class="pref-section-title">Advanced filters</h2>
    <p class="pref-section-subtitle">
      These unlock with paid plans (Plus, Elite, Concierge).
    </p>

    <div class="pref-field">
      <label for="intent">
        Relationship intent
      </label>
      <select id="intent" name="intent">
        <option value="">No preference</option>
        <option value="long-term">Long-term relationship</option>
        <option value="short-term">Short-term / casual</option>
        <option value="open">Open to see what happens</option>
      </select>
    </div>

    <div class="pref-field">
      <label for="dealbreakers">
        Hard dealbreakers
      </label>
      <textarea
        id="dealbreakers"
        name="dealbreakers"
        rows="3"
        placeholder="Habits, values or lifestyles you absolutely cannot accept."
      ></textarea>
    </div>

    <div class="pref-field">
      <p class="pref-field-label">Shared values you care about</p>
      <div class="pref-tags">
        <label>
          <input type="checkbox" name="sharedValues" value="family" />
          Family-focused
        </label>
        <label>
          <input type="checkbox" name="sharedValues" value="career" />
          Career & ambition
        </label>
        <label>
          <input type="checkbox" name="sharedValues" value="faith" />
          Faith / spirituality
        </label>
        <label>
          <input type="checkbox" name="sharedValues" value="fitness" />
          Health & fitness
        </label>
        <label>
          <input type="checkbox" name="sharedValues" value="travel" />
          Travel & experiences
        </label>
      </div>
    </div>
  </section>

  <button class="btn btn-primary" type="submit">
    Save &amp; Continue
  </button>
</form>
    </div>
  </main>

<script>
(() => {
  const canvas = document.getElementById('tm-bg-canvas');
  if (!canvas) return;

  const ctx = canvas.getContext('2d', { alpha: true });
  if (!ctx) return;

  const reduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  const mouse = { x: 0, y: 0, active: false };
  const particles = [];
  let cw = 0, ch = 0, dpr = 1, raf = null;

  const clamp = (v, a, b) => Math.max(a, Math.min(b, v));

  function pickCount() {
    const area = window.innerWidth * window.innerHeight;
    return clamp(Math.floor(area / 22000) + 28, 38, 90);
  }

  function resize() {
    dpr = Math.min(window.devicePixelRatio || 1, 2);
    cw = window.innerWidth;
    ch = window.innerHeight;

    canvas.width = Math.floor(cw * dpr);
    canvas.height = Math.floor(ch * dpr);
    canvas.style.width = cw + 'px';
    canvas.style.height = ch + 'px';

    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

    init();
    draw(true);
  }

  function init() {
    particles.length = 0;
    const count = pickCount();
    for (let i = 0; i < count; i++) {
      particles.push({
        x: Math.random() * cw,
        y: Math.random() * ch,
        vx: (Math.random() - 0.5) * 0.35,
        vy: (Math.random() - 0.5) * 0.35,
        r: 1 + Math.random() * 1.3
      });
    }
  }

  function step() {
    for (const p of particles) {
      p.x += p.vx;
      p.y += p.vy;

      if (p.x < 0 || p.x > cw) p.vx *= -1;
      if (p.y < 0 || p.y > ch) p.vy *= -1;

      p.x = clamp(p.x, 0, cw);
      p.y = clamp(p.y, 0, ch);

      if (mouse.active) {
        const dx = p.x - mouse.x;
        const dy = p.y - mouse.y;
        const dist2 = dx * dx + dy * dy;
        const influence = 220;
        if (dist2 < influence * influence && dist2 > 0.001) {
          const dist = Math.sqrt(dist2);
          const force = (1 - dist / influence) * 0.035;
          p.vx += (dx / dist) * force;
          p.vy += (dy / dist) * force;
        }
      }

      p.vx *= 0.985;
      p.vy *= 0.985;
    }
  }

  function draw(isStatic = false) {
    ctx.clearRect(0, 0, cw, ch);

    ctx.globalCompositeOperation = 'lighter';

    const maxDist = 150;
    const maxDist2 = maxDist * maxDist;

    for (let i = 0; i < particles.length; i++) {
      const a = particles[i];
      for (let j = i + 1; j < particles.length; j++) {
        const b = particles[j];
        const dx = a.x - b.x;
        const dy = a.y - b.y;
        const d2 = dx * dx + dy * dy;

        if (d2 <= maxDist2) {
          const t = 1 - (Math.sqrt(d2) / maxDist);
          const alpha = t * 0.12;
          ctx.strokeStyle = `rgba(255,255,255,${alpha})`;
          ctx.lineWidth = 1;
          ctx.beginPath();
          ctx.moveTo(a.x, a.y);
          ctx.lineTo(b.x, b.y);
          ctx.stroke();
        }
      }
    }

    if (mouse.active) {
      const md = 210, md2 = md * md;
      for (const p of particles) {
        const dx = p.x - mouse.x;
        const dy = p.y - mouse.y;
        const d2 = dx * dx + dy * dy;
        if (d2 < md2) {
          const t = 1 - (Math.sqrt(d2) / md);
          const alpha = t * 0.18;
          ctx.strokeStyle = `rgba(100,233,238,${alpha})`;
          ctx.lineWidth = 1;
          ctx.beginPath();
          ctx.moveTo(p.x, p.y);
          ctx.lineTo(mouse.x, mouse.y);
          ctx.stroke();
        }
      }
    }

    for (const p of particles) {
      ctx.fillStyle = `rgba(255,255,255,0.55)`;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fill();
    }

    ctx.globalCompositeOperation = 'source-over';

    if (!reduceMotion && !isStatic) step();
  }

  function loop() {
    draw(false);
    raf = requestAnimationFrame(loop);
  }

  function onMove(e) {
    const t = e.touches && e.touches[0];
    mouse.x = (t ? t.clientX : e.clientX);
    mouse.y = (t ? t.clientY : e.clientY);
    mouse.active = true;
  }
  function onLeave(){ mouse.active = false; }

  window.addEventListener('resize', () => {
    cancelAnimationFrame(raf); raf = null;
    resize();
    if (!reduceMotion) loop();
  }, { passive: true });

  window.addEventListener('mousemove', onMove, { passive: true });
  window.addEventListener('touchstart', onMove, { passive: true });
  window.addEventListener('touchmove', onMove, { passive: true });
  window.addEventListener('mouseleave', onLeave, { passive: true });

  resize();
  if (!reduceMotion) loop();
})();
</script>

<script src="./tm-loader.js"></script>
<script type="module" src="/preferences.js"></script>
</body>
</html>
